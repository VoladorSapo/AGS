// room script file
function room_Load()
{
  SetBackgroundFrame(Noche);
  if(!Start){
  PlayVideo("INTRO.ogv", eVideoSkipEscKey , 1);
  }
}

function room_AfterFadeIn()
{
  SetTimer(1, (400-TimeSave));
  SetTimer(2, 40);
  if(!Start){
    cJonathan.Say("Gracias, ¿oye como conseguiste que esos lobos...?");
    cCochero.Say("...");
    cCochero.Say("...");
    cCochero.Say("Denn die Toten reiten schnell (Porque los muertos viajan deprisa)");
    Start = true;
  }
  /*Game.Camera.AutoTracking=true;
  player.x = 2970;
  player.y = 1620;
  Game.Camera.AutoTracking=false;
  Game.Camera.X=2810;*/
//gGui2.Visible=true;
  }
  

function hHotspot1_Mode8()
{

}

function hPuertaD_Look()
{
  cJonathan.Walk(4400, 500, eBlock);
  cJonathan.Say("La puerta está cerrada de par en par, es mejor que respete la privacidad del conde.");
}

function Door3_Interact()
{

}

function hSubirAlPiso2_WalkOn()
{
  cConde.FollowCharacter(null);
  player.x = 4400;
  player.y = 800;
  cConde.x = 4400;
  cConde.y = 800;
  cJonathan.Walk(4400, 800, eBlock);
  cJonathan.FaceDirection(eDirectionLeft, eBlock);
  Game.Camera.AutoTracking=true;
  RemoveWalkableArea(4);
  RemoveWalkableArea(2);
  RestoreWalkableArea(3);
  cConde.FollowCharacter(cJonathan, 15, 97);
}

function hSubirAlPiso3_WalkOn()
{ 
cConde.FollowCharacter(null);
cJonathan.Walk(2980,480, eBlock);
  player.x = 2970;
  player.y = 500;
  cConde.x = 3000;
  cConde.y = 500;
  cJonathan.FaceDirection(eDirectionLeft,  eBlock);
  Game.Camera.Y=player.y-Game.Camera.Height/2;
  RemoveWalkableArea(3);
  RemoveWalkableArea(2);
  RestoreWalkableArea(4);
  cConde.FollowCharacter(cJonathan, 15, 97);
}

function oRosario_Look()
{
cJonathan.Walk(4050,  750,  eBlock);
cJonathan.Think("¿Este objeto no me lo dío una mujer? ¿Qué hace aquí fuera de mi equipaje?");
}

function Rosario_Interact()
{
  cJonathan.Walk(4050,  750,  eBlock);
  cJonathan.Think("Debería guardarlo en mi maleta...");
  cJonathan.AddInventory(iRosario);
  oRosario.Visible=false;
  RosarioRecogido=true;
}

function hPuertaEntrada_Interact()
{ 
 player.Walk(2648, 1328,  eBlock);
  cJonathan.Think("Parece que no hay nadie, y el cochero se acaba de ir. ¿Qué hago ahora?");
  FueraPatio=false;
  player.Walk(2648, 1328,  eBlock);
  Game.Camera.AutoTracking=false;
  cJonathan.Transparency = 100;
  while (Game.Camera.X < 2810)
{
    Game.Camera.X += 4;
    Wait(1);
}
  player.x = 2970;
  player.y = 1620;
  Game.Camera.AutoTracking=true;
  cJonathan.FaceDirection(eDirectionRight,  eBlock);
  cJonathan.Transparency = 0;
  RemoveWalkableArea(3);
  RemoveWalkableArea(4);
  RestoreWalkableArea(2);
  
 
}

function hPuertaCerrada_Interact()
{
cJonathan.Walk(3060,  1120, eBlock);
cConde.FollowCharacter(null);
cConde.Walk(3220,  1220,  eBlock);
cConde.Say("Lo ziento mucho pero esa parte del castillo ez peligrosa de noche.");
cConde.FollowCharacter(cJonathan, 15, 97);

}



function room_RepExec()
{
int CamX2=Game.Camera.X + Game.Camera.Width;
int CamX1=Game.Camera.X;
int Jposx=cJonathan.x;

//Label1.Text = String.Format("%d", CamX2);
if(cJonathan.Transparency != 100){
if(FueraPatio){
  if(Jposx>2165){
    Game.Camera.AutoTracking=false;
    while((Game.Camera.X+Game.Camera.Width)>2810){
      Game.Camera.X-=1;
    }
  }else if(Jposx<2165){
    Game.Camera.AutoTracking=true;
  }
}else{
  if(Jposx<(2810+Game.Camera.Width/2)){
    Game.Camera.AutoTracking=false;
    while((Game.Camera.X)<2810){
      Game.Camera.X=2810;
    }
  }else if(Jposx>(2810+Game.Camera.Width/2)){
    Game.Camera.AutoTracking=true;
  }
}
}

//Detecta si el temporizador a acabado, pasa de Dia a Noche o viceversa y resetea
if(IsTimerExpired(1)){
  if(Noche==0){SetFadeColor(80, 40, 1);}
    else{SetFadeColor (40, 70, 125);}
    FadeOut(10);
    
    if(Noche==0){Noche=1; SetBackgroundFrame(Noche);
    
    cJonathanNoche.x=cJonathan.x;
    cJonathanNoche.y=cJonathan.y;
    
    if(cJonathan.FaceDirection(eDirectionLeft)){
    cJonathanNoche.FaceDirection(eDirectionLeft);
    }else{
    cJonathanNoche.FaceDirection(eDirectionRight);  
    }
    
    cJonathanNoche.SetAsPlayer();
    
    cJonathan.Transparency=100;
    cJonathanNoche.Transparency=0;
    
    
    
    }
    else if(Noche==1){Noche=0; SetBackgroundFrame(Noche);
    
    cJonathan.x=cJonathanNoche.x;
    cJonathan.y=cJonathanNoche.y;
    
    if(cJonathanNoche.FaceDirection(eDirectionLeft)){
    cJonathan.FaceDirection(eDirectionLeft);
    }else{
    cJonathan.FaceDirection(eDirectionRight);  
    }
    
    cJonathan.SetAsPlayer();
    
    cJonathanNoche.Transparency=100;
    cJonathan.Transparency=0; 
    
    
    
    }
    
    Wait(10);
    
    if(Noche==1){SetFadeColor(40, 70, 125);}
    else{SetFadeColor(80, 40, 1);}
  
    FadeIn(10);
    SetTimer(1, 400);
    
    Wait(5);
  }

//Detecta si el temporizador 2 ha acabado, esto hace que se guarde el tiempo que haya pasado
//y en el caso de que se cambie de room, todo transcurra normal
if(IsTimerExpired(2)){
  TimeSave=TimeSave+40;
  SetTimer(2, 40);
  }
  }

function hPuertaAlPiso2_Interact()
{
  cConde.FollowCharacter(null);
  cConde.x = 3300;
  cConde.y = 800;
  player.x = 3200;
  player.y = 800;
  cJonathan.Walk(3200, 800, eBlock);
  cJonathan.FaceDirection(eDirectionRight,  eBlock);
  Game.Camera.Y=player.y-Game.Camera.Height/2;
  RemoveWalkableArea(4);
  RemoveWalkableArea(2);
  RestoreWalkableArea(3);
  cConde.FollowCharacter(cJonathan, 15, 97);
}

function hBajarAlPiso1_WalkOn()
{
  cConde.FollowCharacter(null);
  cConde.x = 4300;
  cConde.y = 1210;
  player.x = 4385;
  player.y = 1215;
  RestoreWalkableArea(2);
  cJonathan.Walk(4385, 1215, eBlock);
  cJonathan.FaceDirection(eDirectionLeft,  eBlock);
  Game.Camera.Y=player.y+Game.Camera.Height/2;
  RemoveWalkableArea(3);
  RemoveWalkableArea(4);
  cConde.FollowCharacter(cJonathan, 15, 97);
  }

function hSalidaPatio_WalkOn()
{
  
  player.x = 2000;
  player.y = 1500;
  FueraPatio=true;
  
  
  cJonathan.FaceDirection(eDirectionLeft,  eBlock);
  Game.Camera.X=2810-Game.Camera.Width;
  Game.Camera.Y=player.y-Game.Camera.Height/2;
}

function hPuertaJ_Interact()
{
  if(RosarioRecogido==true){
cConde.FollowCharacter(null);
player.Walk(3290, 495, eBlock);
cConde.Walk(3160, 516, eBlock);
cConde.FaceDirection(eDirectionRight);
cConde.Say("Adelante mi ansiado invitado, pase a zu cuarto, un banquete le eztá esperando.");
player.ChangeRoom(2, 100, 1500, eDirectionRight);
}
  else{
    cJonathan.Think("Tengo la sensación de que se me ha olvidado algo abajo...");
    }
}

function region1_WalksOnto()
{
cJonathan.Think("Creo que no es buena idea salir del castillo, esos lobos tenían pinta de ser muy peligrosos. Además ese bosque me pone los pelos de punta.");
cJonathan.Walk(230,  1380,  eBlock);
}

function region2_WalksOnto()
{
  if(!RegionSonidoDeCaballos){
  if(Noche==0){
  cJonathan.Think("*Sonidos de caballos*");
  }else if(Noche==1){
  cJonathanNoche.Think("*Sonidos de caballos*");  
  }
  cCochero.y = 40;
  RegionSonidoDeCaballos = true;
  }
}



function region3_WalksOnto()
{
  room_RepExec();
if (RegionRecibimiento==false){
cConde.Walk(3200,  1600,  eBlock);
cConde.Say("Bienvenido señor, espero que este castillo sea de sua grado.");
cJonathan.Say("Muchas gracias por recibirme en su morada Don Drácula");
cConde.Say("Oh por favor, no zea tan formal. Venga, le acompañaré mientras contempla el castillo. La zala de invitados se encuentra en la última planta.");
cConde.FollowCharacter(cJonathan, 15, 97);
RegionRecibimiento=true;
  }
  else{
    cJonathan.Think("Debería entrar ya...");
    }
}



function region4_WalksOnto()
{
  if(TutoTerminado==false){
  TutoTerminado=true;
  cConde.FollowCharacter(null);
  cConde.Walk(4000,  800,  eBlock);
  cConde.FaceDirection(eDirectionRight);
  cConde.Say("Espero que zepa qué hacen esos frazcos que lleva con usted");
  cJonathan.Say("Claro, no se preocupe");
  gGui3.Visible=true;
  cConde.FollowCharacter(cJonathan, 15, 97);
  
  }

}
